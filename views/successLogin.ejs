<!DOCTYPE html>
<html ng-app="Loggedin">
<head>
<title>Result</title>
</head>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js">
	
</script>
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js">
	
</script>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js"></script>
<script
	src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.1/angular-sanitize.min.js"></script>

<body style="margin-top: 0px; background-color: #F5F8FA"
	ng-controller="LoggedinCtrl">
	<div class="row"
		style="width: 101%; background-color: white; height: 4rem; border-style: solid">
		<div
			style="width: 30%; float: left; margin-left: 2rem; margin-top: 0.5rem">
			<a href="/home"> <span class="glyphicon glyphicon-home"
				style="font-size: 18px">Home </span></a>
		</div>
		<div style="width: 20%; float: left; text-align: right">
			<img src="/images/logo.png" alt="Twitter Bird"
				style="height: 30px; width: 30px;">

		</div>
		<div
			style="width: 20%; float: left; text-align: right; margin-left: 15rem">
			<input id="searchText" ng-model="searchText" placeholder="Search Twitter"
				style="moz-border-radius: 15px; border-radius: 15px; padding: 5px; float: left" />
			<button id="search" ng-click="searchmembers(searchText)"
				style="border-style: none; height: 30px; width: 40px; float: left;"
				class="glyphicon glyphicon-search"></button>
		</div>
		<div style="width: 15%; float: right;">
			<button id="Profile" ng-click="profile()"
				style="float: left; background-color: #0084B4; height: 30px; width: 70px; float: left; margin-top: 0.25rem;"
				class="btn btn-primary">Profile</button>

			<button id="logout" ng-click="logout()"
				style="margin-left: 3rem; float: right; background-color: #0084B4; height: 30px; width: 70px; float: left; margin-top: 0.25rem"
				class="btn btn-primary">Logout</button>


		</div>

	</div>
	<div style="width: 100%; border-style: ridge; height: 90%; float: left">
		<div id="userinfo"
			style="width: 25%; height: 90%; float: left; background-color: white">
			<div
				style="background-color: #0084B4; height: 8rem; border-style: ridge; border-color: #0084B4;">
			</div>
			<div style="height: 4rem; width: 100%; margin-top: -2rem">
				<div id="userImg"
					style="float: left; width: 33%; height: 100%; text-align: center">
					<img src="/images/NoImg.PNG" alt="No Image" height="70" width="70">
				</div>
				<div id="fullname" style="float: Left; width: 67%; height: 100%;">
					<br /> <label style="width: 100%; margin-bottom: 0px">
						{{username}}</label> <br /> <label style="width: 100%">@{{handle}}</label>
				</div>
			</div>

			<br /> <br />
			<table style="width: 100%">
				<tr style="width: 100%;">
					<td id="numTweets" style="width: 33%%">Tweets</td>
					<td id="followers" style="width: 33%">Followers</td>
					<td id="following" style="width: 33%">Following</td>
				</tr>
				<tr style="width: 100%;">
					<td id="numTweetsvalue" style="width: 33%%">{{numTweetsVal}}</td>
					<td id="followersvalue" style="width: 33%">{{numFollowersVal}}</td>
					<td id="followingvalue" style="width: 33%">{{numFollowingVal}}</td>
				</tr>
			</table>



		</div>

		<div
			style="width: 50%; border-style: ridge; height: 90%; float: left;">
			<form id="myForm">
				<table
					style="width: 100%; border-style: none; height: 90%; float: left;">

					<tr style="background-color: #E8F4FB">
						<td><textarea rows="3" cols="75" id="nTweet"
								style="resize: none" ng-model="nTweet"
								placeholder="What's happening?"></textarea></td>
						<td>
							<button type="button" class="btn btn-info"
								style="background-color: #0084B4" id="registerTweet"
								ng-click="registerTweet()"height: 30px; width: 40px">Tweet</button>


						</td>

					</tr>
					<tr style="background-color: #E8F4FB">
						<td><br></td>
						<td><br></td>
					</tr>

				</table>

			</form>
			<br /> <br /> <br /> <br /> <br />

			<div ng-repeat="t in ftweet"
				style="width: 100%; border-style: ridge; height: 90%; float: left; background-color: white">
				<div style="width: 100%; height: 90%">
					<img src="/images/NoImg.PNG" alt="No Image" height="40px"
						width="40px"></img> <label><a href="#">{{t.usrname}} </a>
						@ {{t.thandle}}</label>

				</div>
				<div id="dtweet" ng-model="dtweet" ng-bind-html="t.tweet"
					style="width: 100%; background-color: white">{{t.tweet}}</div>
				<div style="margin-left: 15rem">
					<a href="#" id="retweet" ng-click="fretweet(t.tweet)"><span class="glyphicon glyphicon-retweet"></a>
				</div>
			</div>
		</div>

		<div
			style="width: 25%; border-style: ridge; height: 90%; float: left; background-color: white;">
			Who to follow <a href="#">View All</a>
			<div ng-repeat="user in suggestedUsers"
				style="width: 100%; border-style: ridge; height: 90%; float: left;">

				<div style="width: 20%; text-align: center; float: left">
					<img src="/images/NoImg.PNG" alt="No Image" height="50px"
						width="50px"></img>
				</div>
				<div ng-model="suggestedUname" style="width: 80%; text-align: left">
					{{user.uname}} @{{user.thandle}} <br>
					<button id="follow" ng-click="follow(user.thandle)"
						style="background-color: #F8FAFC; color: black; height: 30px; width: 70px; float: left; text-align: center; margin-top: 0.5rem"
						class="btn btn-primary">Follow</button>
				</div>



			</div>
		</div>
	</div>




</body>
<script>
	var app = angular.module('Loggedin', [ 'ngSanitize' ]);
	app
			.controller(
					'LoggedinCtrl',
					function($sce, $scope, $http) {
					
						

						$http({
							method : 'GET',
							url : '/loadPage',

						}).success(function(response) {
							console.log(response);
							if (response != "Failure") {
								//display feed
								$scope.numTweetsVal = response[0].TWEETS;
								$scope.username = response[0].uname;
								$scope.numFollowersVal = response[0].FOLLOWERS;
								$scope.numFollowingVal = response[0].FOLLOWING;
								$scope.handle = response[0].thandle;
							}
						}).error(function(error) {

						});

						$http({
							method : 'GET',
							url : '/followSuggestion',

						}).success(function(response) {
							console.log(response);
							$scope.suggestedUsers = response;
						}).error(function(error) {

						});

						$http({
							method : 'GET',
							url : '/fetchTweets',

						})
								.success(
										function(response) {

											$scope.ftweet=response;

											/*$scope.myHTML = 'I am an <code>HTML</code>string with '
													+ '<a href="#">links!</a> and other <em>stuff</em>';*/
										}).error(function(error) {
									console.log(" error");
								});

						$scope.registerTweet = function() {

							$http({
								method : 'POST',
								url : '/registerTweet',
								data : {
									"tweet" : $scope.nTweet,

								}

							}).success(function(response) {
								console.log(response);
								if (response != "Failure") {
									console.log("tweet inserted");

								}
							}).error(function(error) {

							});

						}
						
						$scope.fretweet=function(val){
							
							$http({
								method : 'POST',
								url : '/retweet',
								data : {
									"tweet" : val

								}

							}).success(function(response) {
								console.log(response);
								if (response != "Failure") {
									console.log("tweet inserted");

								}
							}).error(function(error) {

							});
						}
						
						$scope.logout=function(){
							window.location.href='/logout';
						}
						$scope.profile = function() {

							//window.location.href = '/profile';
							$http({
								method : 'POST',
								url : '/sessionChk'

							})
									.success(
											function(response) {
											if(response=="Success"){
												
													window.location.href="/profile";}
												
											})
									.error(
											function(error) {
												
											});
						}

						$scope.follow = function(thandle) {

							$http({
								method : 'POST',
								url : '/follow',
								data : {
									"thandle" : thandle
								}

							}).success(function(response) {
								console.log(response);
								if (response != "Failure") {
									console.log("Followed");

								}
							}).error(function(error) {

							});

						}

					});
</script>


</html>
